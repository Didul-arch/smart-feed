// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  nama     String
  // relation
}

model Kandang {
  id           Int            @id @default(autoincrement())
  nama         String
  lokasi       String?
  kapasitas    Int
  // relation
  sapi         Sapi[]
}

model Sapi {
  id                   Int                      @id @default(autoincrement())
  jenis                String
  bobot                Float
  image                String
  kandang              Kandang                  @relation(fields: [kandangId], references: [id])
  kandangId            Int
  tanggalLahir         DateTime
  tanggalKematian      DateTime?
  // relation
  recordPemberianMakan RecordPemberianMakan[]
  jadwalHarian JadwalHarian[]

}

model Pakan {
  id               Int                      @id @default(autoincrement())
  nama             String
  jenis            String
  banyakStok       Float
  harga            Float?
  image            String
  // relation
  jadwalHarianPagi JadwalHarian[]           @relation("JadwalPagiPakanRel")
  jadwalHarianSore JadwalHarian[]           @relation("JadwalSorePakanRel")
  recordsPakanDiberikan RecordPemberianMakan[] @relation("PakanDiberikanRel")
}


enum Hari {
  SENIN
  SELASA
  RABU
  KAMIS
  JUMAT
  SABTU
  MINGGU
}

enum SesiPemberianMakan {
  PAGI
  SORE
}


model JadwalHarian {
  id          String  @id @default(cuid())
  sapi     Sapi @relation(fields: [sapiId], references: [id], onDelete: Cascade)
  sapiId   Int
  hari        Hari // Enum: SENIN, SELASA, ..., MINGGU

  pagiPakan   Pakan?  @relation("JadwalPagiPakanRel", fields: [pagiPakanId], references: [id], onDelete: SetNull)
  pagiPakanId Int?
  pagiWaktu   String? // Contoh: "07:00"

  sorePakan   Pakan?  @relation("JadwalSorePakanRel", fields: [sorePakanId], references: [id], onDelete: SetNull)
  sorePakanId Int?
  soreWaktu   String? // Contoh: "16:00"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([sapiId, hari]) // Satu kandang hanya punya satu jadwal per hari dalam seminggu
}

model RecordPemberianMakan {
  id                 String             @id @default(cuid())
  sapi               Sapi               @relation(fields: [sapiId], references: [id], onDelete: Cascade)
  sapiId             Int
  pakanDiberikan     Pakan              @relation("PakanDiberikanRel", fields: [pakanDiberikanId], references: [id], onDelete: Restrict) // Pakan yg diberikan tidak boleh null
  pakanDiberikanId   Int

  tanggalPemberian     DateTime // Tanggal pemberian makan (waktu bisa diabaikan atau set ke awal hari)
  sesi                 SesiPemberianMakan // Enum: PAGI, SORE
  waktuPemberianActual DateTime           @default(now()) // Waktu aktual tombol "Beri Makan" ditekan

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([sapiId, tanggalPemberian, sesi]) // Sapi hanya bisa makan sekali per sesi per tanggal
  @@index([kandangId, tanggalPemberian]) // Untuk query cepat berdasarkan kandang dan tanggal
  kandangId Int // Denormalisasi untuk query lebih mudah, diisi dari sapi.kandangId
}